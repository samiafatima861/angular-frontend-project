class FlightDetails {
    constructor() {
        this.routePrices = [
            { 
                route: 'JFK-LHR', 
                price: 450,
                availableDates: ['2023-11-01', '2023-11-05', '2023-11-10', '2023-11-15', '2023-11-20', '2023-11-25', '2023-11-30', 
                                '2023-12-05', '2023-12-10', '2023-12-15', '2023-12-20', '2023-12-25', '2023-12-30',
                                '2024-01-05', '2024-01-10', '2024-01-15', '2024-01-20', '2024-01-25', '2024-01-30',
                                '2024-02-05', '2024-02-10', '2024-02-15', '2024-02-20', '2024-02-25', '2024-02-29',
                                '2024-03-05', '2024-03-10', '2024-03-15', '2024-03-20', '2024-03-25', '2024-03-30',
                                '2024-04-05', '2024-04-10', '2024-04-15', '2024-04-20', '2024-04-25', '2024-04-30',
                                '2024-05-05', '2024-05-10', '2024-05-15', '2024-05-20', '2024-05-25', '2024-05-30',
                                '2024-06-05', '2024-06-10', '2024-06-15', '2024-06-20', '2024-06-25', '2024-06-30']
            },
            { 
                route: 'LHR-JFK', 
                price: 470,
                availableDates: ['2023-11-01', '2023-11-05', '2023-11-10', '2023-11-15', '2023-11-20', '2023-11-25', '2023-11-30', 
                                '2023-12-05', '2023-12-10', '2023-12-15', '2023-12-20', '2023-12-25', '2023-12-30',
                                '2024-01-05', '2024-01-10', '2024-01-15', '2024-01-20', '2024-01-25', '2024-01-30',
                                '2024-02-05', '2024-02-10', '2024-02-15', '2024-02-20', '2024-02-25', '2024-02-29',
                                '2024-03-05', '2024-03-10', '2024-03-15', '2024-03-20', '2024-03-25', '2024-03-30',
                                '2024-04-05', '2024-04-10', '2024-04-15', '2024-04-20', '2024-04-25', '2024-04-30',
                                '2024-05-05', '2024-05-10', '2024-05-15', '2024-05-20', '2024-05-25', '2024-05-30',
                                '2024-06-05', '2024-06-10', '2024-06-15', '2024-06-20', '2024-06-25', '2024-06-30']
            },
            { 
                route: 'LHR-CDG', 
                price: 180,
                availableDates: ['2023-11-01', '2023-11-05', '2023-11-10', '2023-11-15', '2023-11-20', '2023-11-25', '2023-11-30', 
                                '2023-12-05', '2023-12-10', '2023-12-15', '2023-12-20', '2023-12-25', '2023-12-30',
                                '2024-01-05', '2024-01-10', '2024-01-15', '2024-01-20', '2024-01-25', '2024-01-30',
                                '2024-02-05', '2024-02-10', '2024-02-15', '2024-02-20', '2024-02-25', '2024-02-29',
                                '2024-03-05', '2024-03-10', '2024-03-15', '2024-03-20', '2024-03-25', '2024-03-30',
                                '2024-04-05', '2024-04-10', '2024-04-15', '2024-04-20', '2024-04-25', '2024-04-30',
                                '2024-05-05', '2024-05-10', '2024-05-15', '2024-05-20', '2024-05-25', '2024-05-30',
                                '2024-06-05', '2024-06-10', '2024-06-15', '2024-06-20', '2024-06-25', '2024-06-30']
            },
            { 
                route: 'CDG-LHR', 
                price: 175,
                availableDates: ['2023-11-01', '2023-11-05', '2023-11-10', '2023-11-15', '2023-11-20', '2023-11-25', '2023-11-30', 
                                '2023-12-05', '2023-12-10', '2023-12-15', '2023-12-20', '2023-12-25', '2023-12-30',
                                '2024-01-05', '2024-01-10', '2024-01-15', '2024-01-20', '2024-01-25', '2024-01-30',
                                '2024-02-05', '2024-02-10', '2024-02-15', '2024-02-20', '2024-02-25', '2024-02-29',
                                '2024-03-05', '2024-03-10', '2024-03-15', '2024-03-20', '2024-03-25', '2024-03-30',
                                '2024-04-05', '2024-04-10', '2024-04-15', '2024-04-20', '2024-04-25', '2024-04-30',
                                '2024-05-05', '2024-05-10', '2024-05-15', '2024-05-20', '2024-05-25', '2024-05-30',
                                '2024-06-05', '2024-06-10', '2024-06-15', '2024-06-20', '2024-06-25', '2024-06-30']
            },
            { 
                route: 'JFK-DXB', 
                price: 750,
                availableDates: ['2023-11-01', '2023-11-05', '2023-11-10', '2023-11-15', '2023-11-20', '2023-11-25', '2023-11-30', 
                                '2023-12-05', '2023-12-10', '2023-12-15', '2023-12-20', '2023-12-25', '2023-12-30',
                                '2024-01-05', '2024-01-10', '2024-01-15', '2024-01-20', '2024-01-25', '2024-01-30',
                                '2024-02-05', '2024-02-10', '2024-02-15', '2024-02-20', '2024-02-25', '2024-02-29',
                                '2024-03-05', '2024-03-10', '2024-03-15', '2024-03-20', '2024-03-25', '2024-03-30',
                                '2024-04-05', '2024-04-10', '2024-04-15', '2024-04-20', '2024-04-25', '2024-04-30',
                                '2024-05-05', '2024-05-10', '2024-05-15', '2024-05-20', '2024-05-25', '2024-05-30',
                                '2024-06-05', '2024-06-10', '2024-06-15', '2024-06-20', '2024-06-25', '2024-06-30']
            },
            { 
                route: 'DXB-JFK', 
                price: 780,
                availableDates: ['2023-11-01', '2023-11-05', '2023-11-10', '2023-11-15', '2023-11-20', '2023-11-25', '2023-11-30', 
                                '2023-12-05', '2023-12-10', '2023-12-15', '2023-12-20', '2023-12-25', '2023-12-30',
                                '2024-01-05', '2024-01-10', '2024-01-15', '2024-01-20', '2024-01-25', '2024-01-30',
                                '2024-02-05', '2024-02-10', '2024-02-15', '2024-02-20', '2024-02-25', '2024-02-29',
                                '2024-03-05', '2024-03-10', '2024-03-15', '2024-03-20', '2024-03-25', '2024-03-30',
                                '2024-04-05', '2024-04-10', '2024-04-15', '2024-04-20', '2024-04-25', '2024-04-30',
                                '2024-05-05', '2024-05-10', '2024-05-15', '2024-05-20', '2024-05-25', '2024-05-30',
                                '2024-06-05', '2024-06-10', '2024-06-15', '2024-06-20', '2024-06-25', '2024-06-30']
            },
            { 
                route: 'SIN-HKG', 
                price: 320,
                availableDates: ['2023-11-01', '2023-11-05', '2023-11-10', '2023-11-15', '2023-11-20', '2023-11-25', '2023-11-30', 
                                '2023-12-05', '2023-12-10', '2023-12-15', '2023-12-20', '2023-12-25', '2023-12-30',
                                '2024-01-05', '2024-01-10', '2024-01-15', '2024-01-20', '2024-01-25', '2024-01-30',
                                '2024-02-05', '2024-02-10', '2024-02-15', '2024-02-20', '2024-02-25', '2024-02-29',
                                '2024-03-05', '2024-03-10', '2024-03-15', '2024-03-20', '2024-03-25', '2024-03-30',
                                '2024-04-05', '2024-04-10', '2024-04-15', '2024-04-20', '2024-04-25', '2024-04-30',
                                '2024-05-05', '2024-05-10', '2024-05-15', '2024-05-20', '2024-05-25', '2024-05-30',
                                '2024-06-05', '2024-06-10', '2024-06-15', '2024-06-20', '2024-06-25', '2024-06-30']
            },
            { 
                route: 'HKG-SIN', 
                price: 310,
                availableDates: ['2023-11-01', '2023-11-05', '2023-11-10', '2023-11-15', '2023-11-20', '2023-11-25', '2023-11-30', 
                                '2023-12-05', '2023-12-10', '2023-12-15', '2023-12-20', '2023-12-25', '2023-12-30',
                                '2024-01-05', '2024-01-10', '2024-01-15', '2024-01-20', '2024-01-25', '2024-01-30',
                                '2024-02-05', '2024-02-10', '2024-02-15', '2024-02-20', '2024-02-25', '2024-02-29',
                                '2024-03-05', '2024-03-10', '2024-03-15', '2024-03-20', '2024-03-25', '2024-03-30',
                                '2024-04-05', '2024-04-10', '2024-04-15', '2024-04-20', '2024-04-25', '2024-04-30',
                                '2024-05-05', '2024-05-10', '2024-05-15', '2024-05-20', '2024-05-25', '2024-05-30',
                                '2024-06-05', '2024-06-10', '2024-06-15', '2024-06-20', '2024-06-25', '2024-06-30']
            },
            { 
                route: 'default', 
                price: 250,
                availableDates: ['2023-11-01', '2023-11-05', '2023-11-10', '2023-11-15', '2023-11-20', '2023-11-25', '2023-11-30', 
                                '2023-12-05', '2023-12-10', '2023-12-15', '2023-12-20', '2023-12-25', '2023-12-30',
                                '2024-01-05', '2024-01-10', '2024-01-15', '2024-01-20', '2024-01-25', '2024-01-30',
                                '2024-02-05', '2024-02-10', '2024-02-15', '2024-02-20', '2024-02-25', '2024-02-29',
                                '2024-03-05', '2024-03-10', '2024-03-15', '2024-03-20', '2024-03-25', '2024-03-30',
                                '2024-04-05', '2024-04-10', '2024-04-15', '2024-04-20', '2024-04-25', '2024-04-30',
                                '2024-05-05', '2024-05-10', '2024-05-15', '2024-05-20', '2024-05-25', '2024-05-30',
                                '2024-06-05', '2024-06-10', '2024-06-15', '2024-06-20', '2024-06-25', '2024-06-30']
            }
        ];
    }

    getBasePrice(source, destination, date) {
        // Validate inputs
        if (!source || !destination) {
            return "Source and destination are required";
        }
        
        const route = `${source}-${destination}`;
        
        // Find the route
        const foundRoute = this.routePrices.find(r => r.route === route);
        
        if (!foundRoute) {
            // Check if we should use default price or return an error
            const defaultRoute = this.routePrices.find(r => r.route === 'default');
            
            // For demo purposes, we'll use the default price
            // In a production system, you might want to return an error
            console.log(`Route not found: ${route}, using default price`);
            return defaultRoute.price;
        }
        
        // If no date provided, just return the base price
        if (!date) {
            return foundRoute.price;
        }
        
        try {
            // Format the date to YYYY-MM-DD for comparison
            const formattedDate = date; // Already formatted in FlightManager
            
            // Check if the date is available
            if (foundRoute.availableDates && foundRoute.availableDates.includes(formattedDate)) {
                return foundRoute.price;
            } else {
                // Check if the date is in the past
                const selectedDate = new Date(formattedDate);
                const today = new Date();
                today.setHours(0, 0, 0, 0); // Reset time part for comparison
                
                if (selectedDate < today) {
                    console.log(`Date in the past: ${formattedDate} for route ${route}`);
                    return "Cannot book flights for past dates";
                }
                
                // Check if the date is too far in the future
                const maxDate = new Date();
                maxDate.setFullYear(maxDate.getFullYear() + 1); // Max 1 year in advance
                
                if (selectedDate > maxDate) {
                    console.log(`Date too far in future: ${formattedDate} for route ${route}`);
                    return "Cannot book flights more than 1 year in advance";
                }
                
                // For demo purposes, we'll be lenient and return a price anyway
                console.log(`Date not in available dates: ${formattedDate} for route ${route}, but returning price anyway`);
                return foundRoute.price;
            }
        } catch (error) {
            console.error("Error processing date in getBasePrice:", error);
            return "Invalid date format";
        }
    }
}

module.exports = FlightDetails;